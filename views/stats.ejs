<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="theme-color" content="#0f172a" />
        <title>Stats â€“ <%= url.shortId %></title>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900 p-6">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <header class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl md:text-4xl font-semibold tracking-tight text-white">URL Statistics</h1>
                        <p class="text-slate-300 mt-1">Detailed analytics for your shortened URL</p>
                    </div>
                    <a href="/" class="inline-flex items-center px-4 py-2 rounded-lg bg-white/10 border border-white/20 hover:bg-white/15 text-white transition">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                        </svg>
                        Back to Dashboard
                    </a>
                </div>
            </header>

            <!-- URL Info Card -->
            <section class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl p-6 md:p-8 text-white mb-6">
                <h2 class="text-xl font-semibold mb-4 text-indigo-300">URL Information</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Short URL</label>
                        <div class="flex items-center gap-2">
                            <a href="/<%= url.shortId %>" class="font-mono text-lg text-indigo-300 hover:text-indigo-200 underline underline-offset-4" target="_blank">
                                <%= baseUrl %>/<%= url.shortId %>
                            </a>
                            <button type="button" class="text-xs px-3 py-1.5 rounded-md bg-white/10 border border-white/20 hover:bg-white/15 text-slate-200" onclick="copyText('<%= baseUrl %>/<%= url.shortId %>')">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Redirects To</label>
                        <a href="<%= url.redirectUrl %>" class="text-slate-200 hover:text-indigo-300 hover:underline break-all" target="_blank">
                            <%= url.redirectUrl %>
                        </a>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-2">
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Created At</label>
                            <p class="text-slate-200"><%= url.createdAt.toLocaleString() %></p>
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Last Updated</label>
                            <p class="text-slate-200"><%= url.updatedAt.toLocaleString() %></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Analytics Card -->
            <section class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl p-6 md:p-8 text-white mb-6">
                <h2 class="text-xl font-semibold mb-4 text-indigo-300">Analytics Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gradient-to-br from-indigo-500/20 to-purple-500/20 border border-indigo-400/30 rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-slate-300 mb-1">Total Clicks</p>
                                <p class="text-3xl font-bold text-white"><%= url.visitHistory.length %></p>
                            </div>
                            <svg class="w-12 h-12 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"/>
                            </svg>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-emerald-500/20 to-teal-500/20 border border-emerald-400/30 rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-slate-300 mb-1">First Click</p>
                                <p class="text-sm font-medium text-white">
                                    <% if (url.visitHistory.length > 0) { %>
                                        <%= new Date(url.visitHistory[0].timeStamp).toLocaleString() %>
                                    <% } else { %>
                                        No clicks yet
                                    <% } %>
                                </p>
                            </div>
                            <svg class="w-12 h-12 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-rose-500/20 to-pink-500/20 border border-rose-400/30 rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-slate-300 mb-1">Last Click</p>
                                <p class="text-sm font-medium text-white">
                                    <% if (url.visitHistory.length > 0) { %>
                                        <%= new Date(url.visitHistory[url.visitHistory.length - 1].timeStamp).toLocaleString() %>
                                    <% } else { %>
                                        No clicks yet
                                    <% } %>
                                </p>
                            </div>
                            <svg class="w-12 h-12 text-rose-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Click History -->
            <% if (url.visitHistory.length > 0) { %>
                <section class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl overflow-hidden text-white">
                    <div class="px-6 py-4 bg-white/5 border-b border-white/10">
                        <h2 class="text-lg font-medium">Click History</h2>
                        <p class="text-sm text-slate-400 mt-1">Recent clicks on this URL (showing last 50)</p>
                    </div>
                    <div class="overflow-x-auto max-h-96 overflow-y-auto">
                        <table class="w-full">
                            <thead class="bg-white/5 text-slate-200 sticky top-0">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">#</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Timestamp</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Time</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-white/10">
                                <% url.visitHistory.slice().reverse().slice(0, 50).forEach((visit, index) => { %>
                                    <tr class="hover:bg-white/5 transition">
                                        <td class="px-6 py-3 whitespace-nowrap text-sm text-slate-200"><%= index + 1 %></td>
                                        <td class="px-6 py-3 whitespace-nowrap text-sm text-slate-200">
                                            <%= new Date(visit.timeStamp).toLocaleString() %>
                                        </td>
                                        <td class="px-6 py-3 whitespace-nowrap text-sm text-slate-300">
                                            <%= new Date(visit.timeStamp).toLocaleDateString() %>
                                        </td>
                                        <td class="px-6 py-3 whitespace-nowrap text-sm text-slate-300">
                                            <%= new Date(visit.timeStamp).toLocaleTimeString() %>
                                        </td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>
                    <% if (url.visitHistory.length > 50) { %>
                        <div class="px-6 py-3 bg-white/5 border-t border-white/10 text-sm text-slate-400 text-center">
                            Showing 50 of <%= url.visitHistory.length %> total clicks
                        </div>
                    <% } %>
                </section>
            <% } else { %>
                <section class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl p-12 text-center text-white">
                    <svg class="w-16 h-16 mx-auto mb-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <h3 class="text-xl font-semibold mb-2">No Clicks Yet</h3>
                    <p class="text-slate-400">This URL hasn't been clicked yet. Share it to start tracking analytics!</p>
                </section>
            <% } %>

            <p class="mt-8 text-center text-xs text-slate-400">&copy; <%= new Date().getFullYear() %> URL Shortener</p>
        </div>

        <script>
            function copyText(text) {
                if (!navigator.clipboard) {
                    const ta = document.createElement('textarea');
                    ta.value = text;
                    document.body.appendChild(ta);
                    ta.select();
                    try { document.execCommand('copy'); } finally { document.body.removeChild(ta); }
                    return;
                }
                navigator.clipboard.writeText(text).then(() => {
                    // Show a temporary success message
                    const btn = event.target;
                    const originalText = btn.textContent;
                    btn.textContent = 'Copied!';
                    btn.classList.add('bg-emerald-500/20');
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.classList.remove('bg-emerald-500/20');
                    }, 2000);
                });
            }
        </script>
    </body>
</html>
